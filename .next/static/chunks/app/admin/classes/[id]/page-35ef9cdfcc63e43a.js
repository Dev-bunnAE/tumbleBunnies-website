(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[149],{255:(e,t,a)=>{"use strict";function n(e){let{moduleIds:t}=e;return null}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadChunks",{enumerable:!0,get:function(){return n}}),a(5155),a(7650),a(5744),a(589)},1100:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>v});var n=a(5155),r=a(2204),l=a(7857),s=a(2298),i=a(5317),o=a(858),d=a(6645),c=a.n(d),u=a(6766),m=a(6874),f=a.n(m),g=a(5695),p=a(2115),b=a(3159);let h=c()(()=>Promise.all([a.e(998),a.e(706)]).then(a.bind(a,7706)),{loadableGenerated:{webpack:()=>[null]},ssr:!1}),x=c()(()=>Promise.all([a.e(998),a.e(671),a.e(140)]).then(a.bind(a,156)),{loadableGenerated:{webpack:()=>[null]},ssr:!1}),j=c()(()=>Promise.all([a.e(998),a.e(660),a.e(48)]).then(a.bind(a,8667)),{loadableGenerated:{webpack:()=>[null]},ssr:!1}),y=["All Ages","0-1","2-3","4-5","6-7","8-10","11-13"];function v(){let e=(0,g.useRouter)(),t=(0,g.useParams)(),a=Array.isArray(null==t?void 0:t.id)?t.id[0]:null==t?void 0:t.id,[d,c]=(0,p.useState)(null),[m,v]=(0,p.useState)(!1),[w,N]=(0,p.useState)(""),[C,_]=(0,p.useState)(null),[S,P]=(0,p.useState)({x:0,y:0}),[A,O]=(0,p.useState)(1),[k,E]=(0,p.useState)(!1),R=(0,p.useRef)(null),[U,L]=(0,p.useState)(""),[M,T]=(0,p.useState)(!1);function I(e){if(!d)return;let{name:t,value:a}=e.target;c(e=>e&&{...e,[t]:a})}async function D(){if(w&&C){T(!0),L("");try{console.log("Starting image upload...");let e=await new Promise((e,t)=>{let a=new window.Image;a.crossOrigin="anonymous",a.src=w,a.onload=()=>{let n=document.createElement("canvas");n.width=400,n.height=400;let r=n.getContext("2d");if(!r)return t(Error("Canvas context is null"));let l=a.width/a.naturalWidth,s=C.x*l,i=C.y*l;r.drawImage(a,s,i,C.width*l,C.height*l,0,0,400,400),n.toBlob(a=>{if(!a)return void t(Error("Canvas is empty"));e(a)},"image/jpeg",.95)},a.onerror=e=>t(e)});console.log("Image cropped, blob size:",e.size);let t=(0,o.c7)(),a=(0,o.KR)(t,"class-images/".concat(Date.now(),".jpg"));console.log("Uploading to Firebase Storage..."),await (0,o.D)(a,e),console.log("Upload completed, getting download URL...");let n=await (0,o.qk)(a);console.log("Download URL obtained:",n),c(e=>e&&{...e,imageUrl:n}),E(!1)}catch(e){console.error("Upload error:",e),L("Failed to upload image: ".concat(e instanceof Error?e.message:"Unknown error"))}T(!1)}}async function G(t){if(t.preventDefault(),!(null==d?void 0:d.imageUrl))return void L("Please upload and crop a class image.");v(!0);let{id:a,...n}=d;await (0,i.mZ)((0,i.H9)(s.db,"classes",a),n),v(!1),e.push("/admin/classes")}return(0,p.useEffect)(()=>{!async function(){if(!a)return;let e=(0,i.H9)(s.db,"classes",a),t=await (0,i.x7)(e);t.exists()&&c({id:t.id,...t.data()})}()},[a]),d?(0,n.jsx)(r.AdminAuthGuard,{children:(0,n.jsxs)("div",{children:[(0,n.jsx)(l.AdminHeader,{}),(0,n.jsxs)("main",{className:"container mx-auto px-4 py-12 max-w-xl",children:[(0,n.jsx)("h1",{className:"text-3xl font-headline font-bold text-primary mb-8 text-center",children:"Edit Class"}),(0,n.jsxs)("form",{className:"bg-card rounded-lg shadow-md p-6 space-y-4",onSubmit:G,children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Class Name"}),(0,n.jsx)("input",{className:"w-full p-2 border rounded",name:"name",placeholder:"Class Name",value:d.name,onChange:I,required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Description"}),(0,n.jsx)("textarea",{className:"w-full p-2 border rounded",name:"description",placeholder:"Enter a description for this class",value:d.description||"",onChange:I,rows:3})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Age Range"}),(0,n.jsxs)("select",{className:"w-full p-2 border rounded",name:"ageRange",value:d.ageRange||"",onChange:I,required:!0,children:[(0,n.jsx)("option",{value:"",disabled:!0,children:"Select Age Range"}),y.map(e=>(0,n.jsx)("option",{value:e,children:"All Ages"===e?"All Ages":e+" years"},e))]})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Class Image"}),(0,n.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,n.jsx)("input",{type:"file",accept:"image/jpeg,image/png",ref:R,onChange:function(e){let t;if(L(""),"dataTransfer"in e&&e.dataTransfer&&e.dataTransfer.files&&e.dataTransfer.files.length>0?t=e.dataTransfer.files[0]:"target"in e&&e.target&&e.target.files&&e.target.files.length>0&&(t=e.target.files[0]),!t)return;if(!["image/jpeg","image/png"].includes(t.type))return void L("Only JPEG and PNG images are allowed.");if(t.size>0xa00000)return void L("Image must be less than 10MB.");let a=new FileReader;a.addEventListener("load",()=>{N(a.result),E(!0)}),a.readAsDataURL(t)},className:"hidden"}),(0,n.jsxs)("button",{type:"button",className:"bg-primary text-primary-foreground px-4 py-2 rounded font-semibold",onClick:()=>{var e;return null==(e=R.current)?void 0:e.click()},children:[(0,n.jsx)(h,{className:"inline mr-2"})," Upload Image"]}),d.imageUrl&&(0,n.jsx)(u.default,{src:d.imageUrl,alt:"Class image",width:64,height:64,className:"h-16 w-16 object-cover rounded"})]}),U&&(0,n.jsx)("p",{className:"text-destructive text-sm mt-2",children:U}),k&&(0,n.jsxs)("div",{className:"relative w-full h-64 bg-muted rounded mt-4",children:[(0,n.jsx)(b.Ay,{image:w,crop:S,zoom:A,aspect:1,onCropChange:P,onZoomChange:O,onCropComplete:function(e,t){_(t)}}),(0,n.jsxs)("div",{className:"absolute bottom-4 left-0 right-0 flex flex-col items-center",children:[(0,n.jsx)(j,{min:1,max:3,step:.01,value:A,onChange:(e,t)=>O(t),className:"w-1/2"}),(0,n.jsx)("button",{type:"button",className:"mt-2 bg-primary text-primary-foreground px-4 py-2 rounded font-semibold",onClick:D,disabled:M,children:M?(0,n.jsx)(x,{size:20}):"Crop & Upload"})]})]})]}),(0,n.jsx)("button",{className:"bg-primary text-primary-foreground px-4 py-2 rounded font-semibold w-full disabled:opacity-50",type:"submit",disabled:m,children:m?"Saving...":"Save Changes"})]}),(0,n.jsx)("div",{className:"text-center mt-4",children:(0,n.jsx)(f(),{href:"/admin/classes",className:"text-primary hover:underline",children:"Back to Classes"})})]})]})}):(0,n.jsx)(r.AdminAuthGuard,{children:(0,n.jsxs)("div",{children:[(0,n.jsx)(l.AdminHeader,{}),(0,n.jsxs)("main",{className:"container mx-auto px-4 py-12 max-w-xl",children:[(0,n.jsx)("h1",{className:"text-3xl font-headline font-bold text-primary mb-8 text-center",children:"Edit Class"}),(0,n.jsx)("p",{children:"Loading..."})]})]})})}},2146:(e,t,a)=>{"use strict";function n(e){let{reason:t,children:a}=e;return a}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return n}}),a(5262)},4054:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{bindSnapshot:function(){return s},createAsyncLocalStorage:function(){return l},createSnapshot:function(){return i}});let a=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class n{disable(){throw a}getStore(){}run(){throw a}exit(){throw a}enterWith(){throw a}static bind(e){return e}}let r="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function l(){return r?new r:new n}function s(e){return r?r.bind(e):n.bind(e)}function i(){return r?r.snapshot():function(e,...t){return e(...t)}}},5744:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorage",{enumerable:!0,get:function(){return n.workAsyncStorageInstance}});let n=a(7828)},6645:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let n=a(8229)._(a(7357));function r(e,t){var a;let r={};"function"==typeof e&&(r.loader=e);let l={...r,...t};return(0,n.default)({...l,modules:null==(a=l.loadableGenerated)?void 0:a.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7357:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o}});let n=a(5155),r=a(2115),l=a(2146);function s(e){return{default:e&&"default"in e?e.default:e}}a(255);let i={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},o=function(e){let t={...i,...e},a=(0,r.lazy)(()=>t.loader().then(s)),o=t.loading;function d(e){let s=o?(0,n.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,d=i?r.Suspense:r.Fragment,c=t.ssr?(0,n.jsxs)(n.Fragment,{children:[null,(0,n.jsx)(a,{...e})]}):(0,n.jsx)(l.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(a,{...e})});return(0,n.jsx)(d,{...i?{fallback:s}:{},children:c})}return d.displayName="LoadableComponent",d}},7503:(e,t,a)=>{Promise.resolve().then(a.bind(a,1100))},7828:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"workAsyncStorageInstance",{enumerable:!0,get:function(){return n}});let n=(0,a(4054).createAsyncLocalStorage)()}},e=>{var t=t=>e(e.s=t);e.O(0,[992,644,380,537,766,991,470,441,684,358],()=>t(7503)),_N_E=e.O()}]);